---
title: "Hospital-Readmission-Model"
author: "Lianna Novitz"
date: "5/1/2018"
output: html_document
---

```{r, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(tibble)
library(readr)
library(gridExtra)
library(GGally) 
library(leaps) 
library(glmnet)
library(faraway)
library(forcats)
library(ISLR)
library(rpart)
library(rpart.plot)
library(randomForest)
library(knitr)
```

```{r}
diabetes <- read_csv("https://www.dropbox.com/s/odtsp7foaugu694/diabetes_data_clean.csv?dl=1")
```

###Introduction
According to the authors, “The dataset represents 10 years (1999-2008) of clinical care at 130 US hospitals and integrated delivery networks. It includes over 50 features representing patient and hospital outcomes. Information was extracted from the database for encounters that satisfied the following criteria.

1. It is an inpatient encounter (a hospital admission).
2. It is a diabetic encounter, that is, one during which any kind of diabetes was entered to the system as a diagnosis.
3. The length of stay was at least 1 day and at most 14 days.
4. Laboratory tests were performed during the encounter.
5. Medications were administered during the encounter."

Citation: Beata Strack, Jonathan P. DeShazo, Chris Gennings, Juan L. Olmo, Sebastian Ventura, Krzysztof J. Cios, and John N. Clore, “Impact of HbA1c Measurement on Hospital Readmission Rates: Analysis of 70,000 Clinical Database Patient Records,” BioMed Research International, vol. 2014, Article ID 781670, 11 pages, 2014

###Research Question
It's a problem for hospitals if a patient is readmitted before 30 days, so my question is, what characteristics make a patient more likely to be readmitted before 30 days? How can hospital staff reduce this rate?

First of all, let's see what the rate of readmission before 30 days is.

```{r}
kable(
  diabetes %>% 
    group_by(readmitted) %>% 
    count(),
  align = c("l", "c"),
  caption = "Table 1: Readmission Categories"
)
```
```{r, echo=FALSE}
11357/(11357 + 35545 + 54864)
35545/(11357 + 35545 + 54864)
54864/(11357 + 35545 + 54864)
```
The rate of readmission before 30 days is about 11%. The rate of readmission after 30 days is about 35%. The rate of no readmission is about 54%.

###Exploring Relationships


```{r, warning=FALSE, message=FALSE}
summary(diabetes)
```


```{r}
diabetes %>% 
    group_by(race) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(gender) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(age) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(time_in_hospital) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(num_lab_procedures) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(num_procedures) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(num_medications) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(number_outpatient) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(number_emergency) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(number_inpatient) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(number_diagnoses) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(max_glu_serum) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(A1Cresult) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(metformin) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(glimepiride) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(glipizide) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(glyburide) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(pioglitazone) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(rosiglitazone) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(insulin) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(change) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(diabetesMed) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(readmitted) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(admission_source) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(admission_type) %>% 
    count()
```

```{r}
diabetes %>% 
    group_by(discharge_disposition) %>% 
    count()
```
I want to find out characteristics about patients who were readmitted before 30 days was up. 

The density plot below may hint that patients who were sent home have slightly higher rates of readmittance before 30 days. 
```{r}
diabetes %>% 
  ggplot(aes(x=discharge_disposition, fill=factor(readmitted))) +
  geom_density(alpha=.5)
```

```{r}
earlyadmit_tree <- rpart(readmitted ~ .,
                 data=diabetes)
```

```{r}
rpart.plot(earlyadmit_tree, under=FALSE, varlen = 0, yesno = 2, ycompress = TRUE)
```
Another tree to see if I can get better detail in the visuals
```{r}
rpart.plot(earlyadmit_tree, # middle graph
type=4,
extra=101, 
box.palette="GnBu",
branch.lty=3, 
shadow.col="gray", 
nn=TRUE
)
```

```{r}
earlyadmit2_tree <- rpart(readmitted ~ discharge_disposition,
                 data=diabetes)
```

```{r}
rpart.plot(earlyadmit2_tree)
```

To be continued...nonparametric models!
